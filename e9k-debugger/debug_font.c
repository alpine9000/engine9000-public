/*
 * COPYRIGHT Â© 2026 Enable Software Pty Ltd - All Rights Reserved
 *
 * https://github.com/alpine9000/engine9000-public
 *
 * See COPYING for license details
 */

#include "debug_font.h"

static int
debug_font_glyph5x7(unsigned char c, unsigned char rows[7])
{
    if (c == ' ') {
        for (int i=0;i<7;i++) {
            rows[i]=0x00;
        }
        return 1;
    }
    static const unsigned char dig[10][7] = {
        {0x1E,0x21,0x23,0x25,0x29,0x31,0x1E},
        {0x08,0x18,0x08,0x08,0x08,0x08,0x1C},
        {0x1E,0x21,0x01,0x0E,0x10,0x20,0x3F},
        {0x1E,0x21,0x01,0x0E,0x01,0x21,0x1E},
        {0x02,0x06,0x0A,0x12,0x3F,0x02,0x02},
        {0x3F,0x20,0x3E,0x01,0x01,0x21,0x1E},
        {0x0E,0x10,0x20,0x3E,0x21,0x21,0x1E},
        {0x3F,0x01,0x02,0x04,0x08,0x08,0x08},
        {0x1E,0x21,0x21,0x1E,0x21,0x21,0x1E},
        {0x1E,0x21,0x21,0x1F,0x01,0x02,0x1C},
    };
    if (c >= '0' && c <= '9') {
        for (int i=0;i<7;i++) {
            rows[i]=dig[c-'0'][i];
        }
        return 1;
    }
    static const unsigned char up[26][7] = {
        {0x0E,0x11,0x11,0x1F,0x11,0x11,0x11},
        {0x3E,0x11,0x11,0x1E,0x11,0x11,0x3E},
        {0x0E,0x11,0x20,0x20,0x20,0x11,0x0E},
        {0x3C,0x12,0x11,0x11,0x11,0x12,0x3C},
        {0x3F,0x20,0x20,0x3E,0x20,0x20,0x3F},
        {0x3F,0x20,0x20,0x3E,0x20,0x20,0x20},
        {0x0E,0x11,0x20,0x27,0x21,0x11,0x0F},
        {0x11,0x11,0x11,0x1F,0x11,0x11,0x11},
        {0x1C,0x08,0x08,0x08,0x08,0x08,0x1C},
        {0x07,0x02,0x02,0x02,0x02,0x22,0x1C},
        {0x21,0x22,0x24,0x38,0x24,0x22,0x21},
        {0x20,0x20,0x20,0x20,0x20,0x20,0x3F},
        {0x11,0x1B,0x15,0x15,0x11,0x11,0x11},
        {0x11,0x19,0x15,0x13,0x11,0x11,0x11},
        {0x0E,0x11,0x11,0x11,0x11,0x11,0x0E},
        {0x3E,0x11,0x11,0x1E,0x20,0x20,0x20},
        {0x0E,0x11,0x11,0x11,0x15,0x12,0x0D},
        {0x3E,0x11,0x11,0x1E,0x24,0x22,0x21},
        {0x1F,0x20,0x20,0x1E,0x01,0x01,0x3E},
        {0x3F,0x08,0x08,0x08,0x08,0x08,0x08},
        {0x11,0x11,0x11,0x11,0x11,0x11,0x0E},
        {0x11,0x11,0x11,0x11,0x11,0x0A,0x04},
        {0x11,0x11,0x11,0x15,0x15,0x1B,0x11},
        {0x11,0x11,0x0A,0x04,0x0A,0x11,0x11},
        {0x11,0x11,0x11,0x0A,0x04,0x04,0x04},
        {0x3F,0x02,0x04,0x08,0x10,0x20,0x3F},
    };
    if (c >= 'A' && c <= 'Z') {
        for (int i=0;i<7;i++) {
            rows[i]=up[c-'A'][i];
        }
        return 1;
    }
    if (c == '.') {
        unsigned char r[7]={0x00,0x00,0x00,0x00,0x00,0x18,0x18};
        for(int i=0;i<7;i++) {
            rows[i]=r[i];
        }
        return 1;
    }
    if (c == '-') {
        unsigned char r[7]={0x00,0x00,0x00,0x1C,0x00,0x00,0x00};
        for(int i=0;i<7;i++) {
            rows[i]=r[i];
        }
        return 1;
    }
    if (c == '_') {
        unsigned char r[7]={0x00,0x00,0x00,0x00,0x00,0x00,0x3F};
        for(int i=0;i<7;i++) {
            rows[i]=r[i];
        }
        return 1;
    }
    if (c == '/') {
        unsigned char r[7]={0x01,0x02,0x04,0x08,0x10,0x20,0x00};
        for(int i=0;i<7;i++) {
            rows[i]=r[i];
        }
        return 1;
    }
    if (c == ':') {
        unsigned char r[7]={0x00,0x18,0x18,0x00,0x18,0x18,0x00};
        for(int i=0;i<7;i++) {
            rows[i]=r[i];
        }
        return 1;
    }
    return 0;
}

void
debug_font_drawText(SDL_Renderer *ren, int x, int y, const char *s, int scale)
{
    if (!ren || !s) {
        return;
    }
    int cx = x; int cy = y;
    for (; *s; ++s) {
        unsigned char c = (unsigned char)*s;
        if (c == '\n') {
            cy += 8*scale;
            cx = x;
            continue;
        }
        if (c >= 'a' && c <= 'z') {
            c = (unsigned char)(c - 'a' + 'A');
        }
        unsigned char rows[7];
        if (!debug_font_glyph5x7(c, rows)) {
            cx += 6*scale;
            continue;
        }
        for (int r=0;r<7;r++) {
            for (int col=0; col<5; col++) {
                if (rows[r] & (1u << (4-col))) {
                    SDL_Rect pix = { cx + col*scale, cy + r*scale, scale, scale };
                    SDL_RenderFillRect(ren, &pix);
                }
            }
        }
        cx += 6*scale;
    }
}
